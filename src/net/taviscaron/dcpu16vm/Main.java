package net.taviscaron.dcpu16vm;

import net.taviscaron.dcpu16vm.device.GenericClock;
import net.taviscaron.dcpu16vm.device.GenericKeyboard;
import net.taviscaron.dcpu16vm.device.LEM1802;
import net.taviscaron.dcpu16vm.machine.Machine;
import net.taviscaron.dcpu16vm.machine.Processor.State;
import net.taviscaron.dcpu16vm.machine.device.Device;
import net.taviscaron.dcpu16vm.machine.impl.ProcessorImpl;
import net.taviscaron.dcpu16vm.machine.impl.MachineImpl;
import net.taviscaron.dcpu16vm.machine.Memory;
import net.taviscaron.dcpu16vm.machine.Processor;
import net.taviscaron.dcpu16vm.machine.impl.MemoryImpl;
import net.taviscaron.dcpu16vm.util.DebugUtils;

/**
 * dcpu16 virtual machine entry point
 * @author Andrei Senchuk
 */
public class Main {
    private static final short[] dcpu16DiagnosticProgram = new short[] {
        (short)0x7c20, (short)0x0104, (short)0x8461, (short)0x9081, (short)0x8401, (short)0x7c21,
        (short)0x0156, (short)0x7c20, (short)0x0126, (short)0x8461, (short)0xc081, (short)0x8801,
        (short)0x7c21, (short)0x0177, (short)0x7c20, (short)0x0126, (short)0x84c1, (short)0x1801,
        (short)0x8c02, (short)0x86d3, (short)0x02f3, (short)0x7c20, (short)0x011a, (short)0x88c2,
        (short)0xc4d3, (short)0x7f81, (short)0x0011, (short)0x7d40, (short)0x00cb, (short)0x7c01,
        (short)0xf615, (short)0x7c21, (short)0x7349, (short)0x7c41, (short)0x02f0, (short)0x7c20,
        (short)0x005e, (short)0x83d2, (short)0x02f0, (short)0x7f81, (short)0x002e, (short)0x8401,
        (short)0x7821, (short)0x0155, (short)0x7a40, (short)0x02f0, (short)0x7c01, (short)0xb402,
        (short)0x7c21, (short)0x12d0, (short)0x7c41, (short)0x02ee, (short)0x7c20, (short)0x005e,
        (short)0x83d2, (short)0x02ee, (short)0x7f81, (short)0x003f, (short)0x7c21, (short)0x003c,
        (short)0x8401, (short)0x7a40, (short)0x02ee, (short)0x7c01, (short)0x4cae, (short)0x7c21,
        (short)0x74fa, (short)0x7c41, (short)0x02ef, (short)0x7c20, (short)0x005e, (short)0x83d2,
        (short)0x02ef, (short)0x7f81, (short)0x0054, (short)0x9001, (short)0x8c21, (short)0x7a40,
        (short)0x02ef, (short)0x9801, (short)0x7c21, (short)0x4cae, (short)0x7a40, (short)0x02ef,
        (short)0x83d3, (short)0x02ee, (short)0x7c20, (short)0x0071, (short)0x83d3, (short)0x02ef,
        (short)0x7c20, (short)0x0087, (short)0x7f81, (short)0x0054, (short)0x1301, (short)0x1701,
        (short)0x8141, (short)0x7ca1, (short)0x02f3, (short)0x84c1, (short)0x3481, (short)0x0192,
        (short)0x0692, (short)0x0001, (short)0x1941, (short)0x88c2, (short)0x88a2, (short)0xc4d6,
        (short)0x7f81, (short)0x0064, (short)0x60a1, (short)0x6081, (short)0x6381, (short)0x8801,
        (short)0x7a40, (short)0x02ee, (short)0x7852, (short)0x02f2, (short)0x6381, (short)0x0801,
        (short)0x0bc1, (short)0x02f2, (short)0x7c21, (short)0x0198, (short)0xb822, (short)0x7c20,
        (short)0x013b, (short)0x7801, (short)0x02ed, (short)0x8c02, (short)0x7c21, (short)0x0198,
        (short)0x7c20, (short)0x0126, (short)0x6381, (short)0x8401, (short)0x7a40, (short)0x02ef,
        (short)0x8832, (short)0x7c20, (short)0x00ab, (short)0x8432, (short)0x7fc1, (short)0x0205,
        (short)0x0219, (short)0x7fd2, (short)0x01fb, (short)0x0219, (short)0x7c20, (short)0x00b7,
        (short)0x7ca1, (short)0x01b9, (short)0xc0a2, (short)0x78c1, (short)0x0219, (short)0x39a1,
        (short)0x88c2, (short)0x88a2, (short)0x85d3, (short)0x7f81, (short)0x009b, (short)0x7801,
        (short)0x02ed, (short)0x9002, (short)0x7c21, (short)0x01b9, (short)0x8461, (short)0xc081,
        (short)0x7c20, (short)0x0126, (short)0x6381, (short)0x8001, (short)0x7a40, (short)0x02ef,
        (short)0x8412, (short)0x7fc1, (short)0x01fb, (short)0x0219, (short)0x8413, (short)0x7fc1,
        (short)0x020f, (short)0x0219, (short)0x6381, (short)0x8bd2, (short)0x02f1, (short)0x6381,
        (short)0x8fd2, (short)0x02f1, (short)0x6381, (short)0x8bc1, (short)0x02f1, (short)0x7c81,
        (short)0x0232, (short)0x7c20, (short)0x00f0, (short)0xc401, (short)0xc421, (short)0xc441,
        (short)0x7c61, (short)0x2048, (short)0x7a40, (short)0x02ef, (short)0x6381, (short)0x7c12,
        (short)0x4cae, (short)0x7c20, (short)0x00d0, (short)0x0160, (short)0x0701, (short)0x0b01,
        (short)0x1b01, (short)0x1f01, (short)0x0f01, (short)0x1301, (short)0x1701, (short)0x9401,
        (short)0x7a40, (short)0x02ef, (short)0x8832, (short)0x87c1, (short)0x02f1, (short)0x8c33,
        (short)0x7f81, (short)0x00e8, (short)0x8412, (short)0x7c81, (short)0x021a, (short)0x8413,
        (short)0x7c81, (short)0x0226, (short)0x7c20, (short)0x00f0, (short)0x60a1, (short)0x6081,
        (short)0x6061, (short)0x60e1, (short)0x60c1, (short)0x6041, (short)0x6021, (short)0x6381,
        (short)0x7ca1, (short)0x01da, (short)0xc0a2, (short)0x10c1, (short)0x39a1, (short)0x88c2,
        (short)0x88a2, (short)0x85d3, (short)0x7f81, (short)0x00f4, (short)0x7801, (short)0x02ed,
        (short)0x9402, (short)0x7c21, (short)0x01da, (short)0x8461, (short)0xc081, (short)0x7c20,
        (short)0x0126, (short)0x6381, (short)0x1a00, (short)0x88c3, (short)0x1a20, (short)0x7ce1,
        (short)0x023e, (short)0x84a1, (short)0x3c12, (short)0x5c32, (short)0x0001, (short)0x1ec1,
        (short)0x02f3, (short)0x7ce2, (short)0x0023, (short)0x88a2, (short)0x78b3, (short)0x02ed,
        (short)0x7f81, (short)0x010a, (short)0x84d2, (short)0x6381, (short)0x7f81, (short)0x0105,
        (short)0x5821, (short)0x02f3, (short)0x8c22, (short)0x18a1, (short)0x88a2, (short)0x7ca2,
        (short)0x0030, (short)0x1621, (short)0x0002, (short)0x7c20, (short)0x0126, (short)0x6381,
        (short)0x0f01, (short)0x1301, (short)0x0301, (short)0x7c04, (short)0x0020, (short)0x7802,
        (short)0x0155, (short)0xa46f, (short)0xb48f, (short)0x106b, (short)0x2501, (short)0x0d0b,
        (short)0x8822, (short)0x8802, (short)0x8533, (short)0x7f81, (short)0x0130, (short)0x6001,
        (short)0x6081, (short)0x6061, (short)0x6381, (short)0x0301, (short)0x0701, (short)0x0f01,
        (short)0x1f01, (short)0x84e1, (short)0x0061, (short)0xac68, (short)0x0f01, (short)0xac06,
        (short)0x88e2, (short)0x8414, (short)0x7f81, (short)0x0140, (short)0x6121, (short)0x7d22,
        (short)0x0030, (short)0x88e3, (short)0x8822, (short)0x84f4, (short)0x7f81, (short)0x0148,
        (short)0x60e1, (short)0x6061, (short)0x6021, (short)0x6001, (short)0x6381, (short)0x8000,
        (short)0x003d, (short)0x003d, (short)0x003d, (short)0x003d, (short)0x003d, (short)0x0020,
        (short)0x0044, (short)0x0043, (short)0x0050, (short)0x0055, (short)0x002d, (short)0x0031,
        (short)0x0036, (short)0x0020, (short)0x0044, (short)0x0069, (short)0x0061, (short)0x0067,
        (short)0x006e, (short)0x006f, (short)0x0073, (short)0x0074, (short)0x0069, (short)0x0063,
        (short)0x0073, (short)0x0020, (short)0x003d, (short)0x003d, (short)0x003d, (short)0x003d,
        (short)0x003d, (short)0x003d, (short)0x0000, (short)0x0020, (short)0x0044, (short)0x0069,
        (short)0x0073, (short)0x0063, (short)0x006f, (short)0x0076, (short)0x0065, (short)0x0072,
        (short)0x0065, (short)0x0064, (short)0x0020, (short)0x0068, (short)0x0061, (short)0x0072,
        (short)0x0064, (short)0x0077, (short)0x0061, (short)0x0072, (short)0x0065, (short)0x003a,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000,
        (short)0x0020, (short)0x0043, (short)0x006c, (short)0x006f, (short)0x0063, (short)0x006b,
        (short)0x0020, (short)0x0074, (short)0x0069, (short)0x006d, (short)0x0065, (short)0x003a,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0020, (short)0x004d, (short)0x0065,
        (short)0x0064, (short)0x0069, (short)0x0061, (short)0x0020, (short)0x0073, (short)0x0074,
        (short)0x0061, (short)0x0074, (short)0x0075, (short)0x0073, (short)0x003a, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000,
        (short)0x0020, (short)0x004d, (short)0x0065, (short)0x0064, (short)0x0069, (short)0x0061,
        (short)0x0020, (short)0x0074, (short)0x0065, (short)0x0073, (short)0x0074, (short)0x003a,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0061, (short)0x0076, (short)0x0061,
        (short)0x0069, (short)0x006c, (short)0x0061, (short)0x0062, (short)0x006c, (short)0x0065,
        (short)0x0000, (short)0x006e, (short)0x006f, (short)0x006e, (short)0x0065, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0045,
        (short)0x0052, (short)0x0052, (short)0x004f, (short)0x0052, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0000, (short)0xffff, (short)0x0073, (short)0x0075,
        (short)0x0063, (short)0x0063, (short)0x0065, (short)0x0073, (short)0x0073, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0066, (short)0x0061,
        (short)0x0069, (short)0x006c, (short)0x0065, (short)0x0064, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0069, (short)0x006e,
        (short)0x0020, (short)0x0070, (short)0x0072, (short)0x006f, (short)0x0067, (short)0x0072,
        (short)0x0065, (short)0x0073, (short)0x0073, (short)0x0000, (short)0xf615, (short)0x7349,
        (short)0x0020, (short)0x0020, (short)0x0058, (short)0x002e, (short)0x0020, (short)0x004c,
        (short)0x0045, (short)0x004d, (short)0x002d, (short)0x0031, (short)0x0038, (short)0x0030,
        (short)0x0032, (short)0x0020, (short)0x004d, (short)0x006f, (short)0x006e, (short)0x0069,
        (short)0x0074, (short)0x006f, (short)0x0072, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0000, (short)0x7406, (short)0x30cf, (short)0x0020,
        (short)0x0020, (short)0x0058, (short)0x002e, (short)0x0020, (short)0x0047, (short)0x0065,
        (short)0x006e, (short)0x0065, (short)0x0072, (short)0x0069, (short)0x0063, (short)0x0020,
        (short)0x004b, (short)0x0065, (short)0x0079, (short)0x0062, (short)0x006f, (short)0x0061,
        (short)0x0072, (short)0x0064, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0000, (short)0xb402, (short)0x12d0, (short)0x0020, (short)0x0020,
        (short)0x0058, (short)0x002e, (short)0x0020, (short)0x0047, (short)0x0065, (short)0x006e,
        (short)0x0065, (short)0x0072, (short)0x0069, (short)0x0063, (short)0x0020, (short)0x0043,
        (short)0x006c, (short)0x006f, (short)0x0063, (short)0x006b, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0000, (short)0x4cae, (short)0x74fa, (short)0x0020, (short)0x0020, (short)0x0058,
        (short)0x002e, (short)0x0020, (short)0x0048, (short)0x004d, (short)0x0044, (short)0x0032,
        (short)0x0030, (short)0x0034, (short)0x0033, (short)0x0020, (short)0x0048, (short)0x0061,
        (short)0x0072, (short)0x006f, (short)0x006c, (short)0x0064, (short)0x0020, (short)0x004d,
        (short)0x0065, (short)0x0064, (short)0x0069, (short)0x0061, (short)0x0020, (short)0x0044,
        (short)0x0072, (short)0x0069, (short)0x0076, (short)0x0065, (short)0x0020, (short)0x0000,
        (short)0xbf3c, (short)0x42ba, (short)0x0020, (short)0x0020, (short)0x0058, (short)0x002e,
        (short)0x0020, (short)0x0053, (short)0x0050, (short)0x0045, (short)0x0044, (short)0x0033,
        (short)0x0020, (short)0x0044, (short)0x0069, (short)0x0073, (short)0x0070, (short)0x006c,
        (short)0x0061, (short)0x0079, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020,
        (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0020, (short)0x0000, (short)0x0005,
        (short)0xffff, (short)0xffff, (short)0xffff, (short)0x0000, (short)0x0000, (short)0x0000,
        (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000,
        (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000,
        (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000, (short)0x0000,
    };

    public static void main(String[] args) {
        Processor processor = new ProcessorImpl();
        processor.attachDebugger(new Processor.Debugger() {
            @Override
            public void dumpState(State state, Memory memory) {
                DebugUtils.printProcessorStateDump(state, System.out);
                DebugUtils.pause(100);
            }
        });
        
        Memory memory = new MemoryImpl();
        Device[] devices = new Device[] {
            new GenericClock(),
            new GenericKeyboard(),
            new LEM1802(),
        };

        Machine machine = new MachineImpl(processor, memory, devices);
        machine.loadProgram(dcpu16DiagnosticProgram);
        machine.start();
    }
}
